<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Process Simulator Designer v2.0</title>
  <link rel="stylesheet" href="css/designer-style.css">
</head>
<body>

<div class="designer-container">
  
  <!-- Left Sidebar: Component Library -->
  <aside class="library-panel">
    <div class="library-header">
      <h2>Components</h2>
      <input 
        type="text" 
        id="searchComponents" 
        placeholder="Search components..."
        class="search-input"
      >
    </div>
    <div class="library-content" id="componentPalette">
      <!-- Populated by designer.js -->
    </div>
  </aside>

  <!-- Main Canvas Area -->
  <main class="canvas-area">
    <div class="toolbar">
      <div class="toolbar-section">
        <button id="selectTool" class="tool-btn active" title="Select Tool">
          <span>🖱️</span> Select
        </button>
        <button id="connectTool" class="tool-btn" title="Connect Tool">
          <span>🔗</span> Connect
        </button>
      </div>
      
      <div class="toolbar-section">
        <label class="toolbar-option">
          <input type="checkbox" id="gridToggle" checked>
          <span>Grid</span>
        </label>
        <label class="toolbar-option">
          <input type="checkbox" id="snapToggle" checked>
          <span>Snap</span>
        </label>
      </div>

      <div class="toolbar-section">
        <button id="previewBtn" class="btn" title="Preview Design">
          👁️ Preview
        </button>
        <button id="importBtn" class="btn" title="Import Design">
          📥 Import
        </button>
        <button id="saveDesignBtn" class="btn" title="Save Design as JSON">
          💾 Save Design
        </button>
      </div>

      <div class="toolbar-section">
        <button id="clearBtn" class="btn btn-warning" title="Clear Canvas">
          🗑️ Clear
        </button>

        <button id="exportBtn" class="btn btn-primary" title="Export Simulator">
          📤 Export Sim
        </button>

        <button id="exportSingleFile" class="btn btn-primary" title="Export Single-File HTML">
          📄 Single-File
        </button>

        <button id="exportZip" class="btn" title="Export Flat Folder / ZIP">
          📦 ZIP
        </button>
      </div>

      <div class="toolbar-stats">
        <span id="componentCount">Components: 0</span>
        <span id="connectionCount">Connections: 0</span>
        <span id="mousePos">X: 0, Y: 0</span>
      </div>
    </div>

    <div class="canvas-wrapper">
      <svg 
        id="canvas" 
        viewBox="0 0 1000 600" 
        xmlns="http://www.w3.org/2000/svg"
        class="design-canvas"
      >
        <defs>
          <pattern id="designerGrid" width="20" height="20" patternUnits="userSpaceOnUse">
            <path d="M 20 0 L 0 0 0 20" fill="none" stroke="#22305f" stroke-width="1"/>
          </pattern>
        </defs>
        
        <rect 
          id="gridRect" 
          x="0" 
          y="0" 
          width="100%" 
          height="100%" 
          fill="url(#designerGrid)"
          opacity="0.4"
        />
        
        <g id="connectionsLayer"></g>
        <g id="componentsLayer"></g>
      </svg>
    </div>
  </main>

  <!-- Right Sidebar: Properties -->
  <aside class="properties-panel">
    <div class="properties-header">
      <h2>Properties</h2>
    </div>
    <div class="properties-content" id="propertiesContent">
      <div class="empty-state">
        <div class="empty-icon">📋</div>
        <p>Select a component to edit its properties</p>
      </div>
    </div>
  </aside>

</div>

<!-- Export Modal -->
<div id="exportModal" class="modal-overlay" style="display: none;" aria-hidden="true">
  <div class="modal-container">
    <button 
      id="exportModalClose" 
      class="modal-close" 
      aria-label="Close export dialog"
    >
      ×
    </button>
    
    <div class="modal-header">
      <h2>📤 Export Simulator</h2>
    </div>
    
    <div class="modal-body">
      <div class="export-info">
        <div class="info-row">
          <span>Components:</span>
          <strong id="compCount">0</strong>
        </div>
        <div class="info-row">
          <span>Connections:</span>
          <strong id="connCount">0</strong>
        </div>
      </div>

      <div class="form-field">
        <label for="simName">Simulator Name:</label>
        <input 
          type="text" 
          id="simName" 
          placeholder="My Process Simulator"
          value="My Simulator"
          class="text-input"
        >
      </div>

      <div class="export-note">
        <strong>📁 Note:</strong>
        <p>Exports standalone HTML file with all engine code embedded from GitHub.</p>
      </div>
    </div>
    
    <div class="modal-footer">
      <button id="exportCancelBtn" class="btn">Cancel</button>
      <button id="exportConfirmBtn" class="btn btn-primary">Export</button>
    </div>
  </div>
</div>

<!-- Scripts -->
<!-- JSZip for ZIP export support -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

<!-- Load scripts in correct order with correct paths -->
<script src="js/componentLibrary.js"></script>
<script src="js/exporter.js"></script>
<script src="js/designer.js"></script>

</body>
</html>
