<!DOCTYPE html>
<html lang="en">
<head>
  <title>My Simulator - Process Simulator</title>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="generator" content="Process Simulator Designer v2.0.0"/>
  <meta name="export-date" content="2025-10-15T12:17:55.584Z"/>
  <meta name="engine-path" content="../../js"/>
  <link rel="stylesheet" href="../../js/style.css">

  <!-- Core Architecture -->
  <script src="../../js/core/Component.js" defer></script>
  <script src="../../js/core/FlowNetwork.js" defer></script>
  <script src="../../js/core/ComponentManager.js" defer></script>

  <!-- Boundary Components -->
  <script src="../../js/components/sources/Feed.js" defer></script>
  <script src="../../js/components/sinks/Drain.js" defer></script>

  <!-- Tank Components -->
  <script src="../../js/components/tanks/Tank.js" defer></script>

  <!-- Pump Components -->
  <script src="../../js/components/pumps/Pump.js" defer></script>
  <script src="../../js/components/pumps/FixedSpeedPump.js" defer></script>
  <script src="../../js/components/pumps/VariableSpeedPump.js" defer></script>
  <script src="../../js/components/pumps/ThreeSpeedPump.js" defer></script>

  <!-- Valve Components -->
  <script src="../../js/components/valves/Valve.js" defer></script>

  <!-- Pipe Components -->
  <script src="../../js/components/pipes/Pipe.js" defer></script>

  <!-- Sensor Components -->
  <script src="../../js/components/sensors/PressureSensor.js" defer></script>

  <!-- Managers -->
  <script src="../../js/managers/TankManager.js" defer></script>
  <script src="../../js/managers/PumpManager.js" defer></script>
  <script src="../../js/managers/ValveManager.js" defer></script>
  <script src="../../js/managers/PipeManager.js" defer></script>
  <script src="../../js/managers/PressureManager.js" defer></script>

  <!-- Configuration -->
  <script src="./systemConfig.js" defer></script>

  <!-- Initialize -->
  <script defer>
    // Set engine version for compatibility check
    window.ENGINE_VERSION = '1.0.0';
    
    window.addEventListener('DOMContentLoaded', () => {
      setTimeout(() => {
        console.log('=== INITIALIZING My Simulator ===');
        
        if (!window.SYSTEM_CONFIG) {
          console.error('❌ SYSTEM_CONFIG not loaded');
          alert('❌ Configuration failed to load. Check console for details.');
          return;
        }
        if (!window.ComponentManager) {
          console.error('❌ ComponentManager not loaded');
          const enginePath = document.querySelector('meta[name="engine-path"]')?.content || 'unknown';
          alert(`❌ Engine files not loaded. Check that your engine folder exists at: ${enginePath}

Expected structure:
- ${enginePath}/core/
- ${enginePath}/components/
- ${enginePath}/managers/`);
          return;
        }
        
        console.log('✅ All components loaded');
        
        window.componentManager = new ComponentManager(SYSTEM_CONFIG);
        window.componentManager.initialize().then(success => {
          if (success) {
            console.log('✅ System initialized successfully');
            window.componentManager.start();
            console.log('✅ Simulation started');
          } else {
            console.error('❌ System initialization failed');
            alert('❌ Simulation failed to start. Check console for details.');
          }
        });
      }, 500);
    });
  </script>
</head>

<body>

<button id="controlsToggle" class="controls-toggle" aria-controls="controlsDrawer" aria-expanded="false">
  Controls
</button>
  
<div class="app">
  <div class="grid">
    <div class="card stage">
      <svg viewBox="0 0 1000 600" aria-labelledby="title desc" role="img">
        <title id="title">My Simulator</title>
        <desc id="desc">Interactive process simulator. Click components to control them.</desc>
        
        <defs>
          <pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse">
            <path d="M 20 0 L 0 0 0 20" fill="none" stroke="#22305f" stroke-width="1"></path>
          </pattern>
          <linearGradient id="liquid" x1="0" y1="0" x2="0" y2="1">
            <stop offset="0%" stop-color="#7cc8ff"></stop>
            <stop offset="100%" stop-color="#2d8bd6"></stop>
          </linearGradient>
        </defs>
        
        <rect x="0" y="0" width="1000" height="600" fill="url(#grid)" opacity="0.4"></rect>
        
        <!-- PIPES -->
        
        <!-- PIPE: Feed 3 to Control Valve 4 -->
        <g id="pipe1" class="pipe">
          <path class="pipe-body" d="M 140 -40 L 320 -40" fill="none" stroke="#9bb0ff" stroke-width="20"></path>
          <path id="pipe1Flow" class="pipe-flow" d="M 140 -40 L 320 -40" fill="none" stroke="#7cc8ff" stroke-width="8"></path>
        </g>
        
        <!-- PIPE: Control Valve 4 to Tank 2 -->
        <g id="pipe2" class="pipe">
          <path class="pipe-body" d="M 320 -40 L 440 180" fill="none" stroke="#9bb0ff" stroke-width="20"></path>
          <path id="pipe2Flow" class="pipe-flow" d="M 320 -40 L 440 180" fill="none" stroke="#7cc8ff" stroke-width="8"></path>
        </g>
        
        <!-- PIPE: Tank 2 to Fixed Speed Pump 5 -->
        <g id="pipe3" class="pipe">
          <path class="pipe-body" d="M 440 180 L 620 220" fill="none" stroke="#9bb0ff" stroke-width="20"></path>
          <path id="pipe3Flow" class="pipe-flow" d="M 440 180 L 620 220" fill="none" stroke="#7cc8ff" stroke-width="8"></path>
        </g>
        
        <!-- PIPE: Fixed Speed Pump 5 to Control Valve 6 -->
        <g id="pipe4" class="pipe">
          <path class="pipe-body" d="M 620 220 L 620 -40" fill="none" stroke="#9bb0ff" stroke-width="20"></path>
          <path id="pipe4Flow" class="pipe-flow" d="M 620 220 L 620 -40" fill="none" stroke="#7cc8ff" stroke-width="8"></path>
        </g>
        
        <!-- PIPE: Control Valve 6 to Drain 7 -->
        <g id="pipe5" class="pipe">
          <path class="pipe-body" d="M 620 -40 L 820 -40" fill="none" stroke="#9bb0ff" stroke-width="20"></path>
          <path id="pipe5Flow" class="pipe-flow" d="M 620 -40 L 820 -40" fill="none" stroke="#7cc8ff" stroke-width="8"></path>
        </g>
        
        <!-- COMPONENTS -->
        
        <!-- TANK: Tank 2 -->
        <g id="comp_1" transform="translate(440, 180)">
          <rect x="-80" y="-90" width="160" height="180" rx="12" fill="#0e1734" stroke="#2a3d78" stroke-width="3"></rect>
          <rect id="comp_1LevelRect" x="-74" y="88" width="148" height="0" fill="url(#liquid)" class="levelRect"></rect>
          <text x="0" y="-100" text-anchor="middle" fill="#9bb0ff" font-size="14">Tank 2</text>
        </g>
        
        <!-- FEED: Feed 3 -->
        <g id="comp_2" transform="translate(140, -40)">
          <circle r="20" fill="#10b98120" stroke="#10b981" stroke-width="2"></circle>
          <text x="0" y="5" text-anchor="middle" font-size="20">⚡</text>
          <text x="0" y="-30" text-anchor="middle" fill="#9bb0ff" font-size="12">Feed 3</text>
        </g>
        
        <!-- VALVE: Control Valve 4 -->
        <g id="comp_3" class="valve" transform="translate(320, -40)" tabindex="0" role="button" aria-pressed="false" aria-label="Control Valve 4">
          <image href="https://sco314.github.io/tank-sim/Valve-Icon-Transparent-bg.png" x="-38" y="-38" width="76" height="76" />
          <text x="0" y="-50" text-anchor="middle" fill="#9bb0ff" font-size="12">Control Valve 4</text>
        </g>
        
        <!-- PUMP: Fixed Speed Pump 5 -->
        <g id="comp_4" class="pump" transform="translate(620, 220)" tabindex="0" role="button" aria-pressed="false" aria-label="Fixed Speed Pump 5">
          <image href="https://sco314.github.io/tank-sim/cent-pump-9-inlet-left.png" x="-60" y="-60" width="120" height="120" />
          <text x="0" y="-70" text-anchor="middle" fill="#9bb0ff" font-size="12">Fixed Speed Pump 5</text>
        </g>
        
        <!-- VALVE: Control Valve 6 -->
        <g id="comp_5" class="valve" transform="translate(620, -40)" tabindex="0" role="button" aria-pressed="false" aria-label="Control Valve 6">
          <image href="https://sco314.github.io/tank-sim/Valve-Icon-Transparent-bg.png" x="-38" y="-38" width="76" height="76" />
          <text x="0" y="-50" text-anchor="middle" fill="#9bb0ff" font-size="12">Control Valve 6</text>
        </g>
        
        <!-- DRAIN: Drain 7 -->
        <g id="comp_6" transform="translate(820, -40)">
          <circle r="20" fill="#ef444420" stroke="#ef4444" stroke-width="2"></circle>
          <text x="0" y="5" text-anchor="middle" font-size="20">⬇️</text>
          <text x="0" y="-30" text-anchor="middle" fill="#9bb0ff" font-size="12">Drain 7</text>
        </g>
      </svg>
    </div>

    <!-- Controls Drawer -->
    <aside id="controlsDrawer" class="controls-drawer" aria-hidden="true">
      <div class="controls-panel card" role="dialog" aria-modal="true" aria-labelledby="controlsTitle">
        <button id="controlsClose" class="controls-close" aria-label="Close controls">×</button>

        <div>
          <h1 id="controlsTitle">System Controls</h1>
          <div class="sub">My Simulator - Click components to interact</div>
          
          <div class="controls">
            <div class="row">
              <button type="button" id="pauseBtn" aria-pressed="false" class="btn">Pause</button>
              <button type="button" id="resetBtn" class="btn">Reset</button>
            </div>
          </div>

          <hr/>
          <h1>System Status</h1>
          <div class="kv" id="systemStatus">
            <div>Status</div><div id="simStatus">Running</div>
          </div>
          
          <hr/>
          <h1>Debug</h1>
          <button type="button" id="debugBtn" class="btn">Show Debug Info</button>
          <pre id="debugOutput" style="display:none; font-size:10px; max-height:200px; overflow:auto; background:#0e1734; padding:8px; margin-top:8px;"></pre>
        </div>
      </div>
    </aside>
  </div>
</div>

<!-- Controls Script -->
<script>
(function(){
  const drawer = document.getElementById('controlsDrawer');
  const panel = drawer.querySelector('.controls-panel');
  const toggle = document.getElementById('controlsToggle');
  const closeBtn = document.getElementById('controlsClose');

  function openDrawer(){
    drawer.classList.add('open');
    drawer.setAttribute('aria-hidden','false');
    toggle.setAttribute('aria-expanded','true');
    setTimeout(() => closeBtn.focus(), 0);
  }
  function closeDrawer(){
    drawer.classList.remove('open');
    drawer.setAttribute('aria-hidden','true');
    toggle.setAttribute('aria-expanded','false');
    toggle.focus();
  }

  toggle.addEventListener('click', openDrawer);
  closeBtn.addEventListener('click', closeDrawer);
  drawer.addEventListener('click', (e) => {
    if (!panel.contains(e.target)) closeDrawer();
  });
  window.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && drawer.classList.contains('open')) closeDrawer();
  });
  
  const pauseBtn = document.getElementById('pauseBtn');
  pauseBtn?.addEventListener('click', () => {
    if (window.componentManager) {
      if (window.componentManager.paused) {
        window.componentManager.resume();
        pauseBtn.textContent = 'Pause';
      } else {
        window.componentManager.pause();
        pauseBtn.textContent = 'Resume';
      }
    }
  });
  
  const resetBtn = document.getElementById('resetBtn');
  resetBtn?.addEventListener('click', () => {
    if (window.componentManager) {
      window.componentManager.reset();
      console.log('System reset');
    }
  });
  
  const debugBtn = document.getElementById('debugBtn');
  const debugOutput = document.getElementById('debugOutput');
  debugBtn?.addEventListener('click', () => {
    if (window.componentManager) {
      const info = window.componentManager.getSystemInfo();
      debugOutput.textContent = JSON.stringify(info, null, 2);
      debugOutput.style.display = debugOutput.style.display === 'none' ? 'block' : 'none';
    }
  });
})();
</script>

</body>
</html>