<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Tank Level Display</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            background-color: #f0f0f0;
        }
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .controls {
            margin-top: 20px;
            display: flex;
            gap: 20px;
            align-items: center;
        }
        input[type="range"] {
            width: 300px;
        }
        input[type="number"] {
            width: 80px;
            padding: 5px;
            font-size: 16px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background-color: #15bac7;
            color: white;
            border: none;
            border-radius: 5px;
        }
        button:hover {
            background-color: #0da5b1;
        }
        .info {
            margin-top: 20px;
            padding: 15px;
            background-color: #e8f4f8;
            border-radius: 5px;
            max-width: 600px;
        }
        .info h3 {
            margin-top: 0;
        }
        .info code {
            background-color: #d1e7ed;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Dynamic Tank Level Display</h1>

        <svg id="tankSvg" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 359.25 654.75" width="400">
            <defs>
                <style>
                    .cls-1 { fill: #949299; }
                    .cls-2 { fill: #15bac7; }
                    .cls-3 { fill: #384551; }
                    .cls-percentage {
                        fill: #333333;
                        font-family: Arial, sans-serif;
                        font-size: 32px;
                        font-weight: bold;
                        text-anchor: middle;
                    }
                </style>
            </defs>

            <!-- Liquid rectangle (grows from bottom) -->
            <rect id="liquidRect" class="cls-2" x="10.14" y="88.127" width="342.685" height="396.825"/>

            <!-- Curved top of liquid (ellipse) -->
            <ellipse id="liquidTop" class="cls-2" cx="181.4825" cy="88.127" rx="171.3425" ry="15"/>

            <!-- Percentage text -->
            <text id="percentageText" class="cls-percentage" x="181.4825" y="66">100</text>

            <!-- Grey top curved area (tank top) -->
            <path class="cls-1" d="M8.571,191.429c0-30.004,1.284-90.485,1.689-108.809.076-3.429.121-5.382.121-5.382l2.381-5.81,6.19-9.143,8.762-6.286,14.476-7.714,37.143-14.571,24.667-7.429,39.619-6.286,12.762-1.524h47.429l25.714,2.095,64.19,16.762,38.159,16.381,8,5.333,8.254,8.127,3.556,9.016,1.143,11.937v89.016c-2.207.143-5.466.379-9.397.762-37.613,3.667-47.026,12.062-66.286,13.524-31.318,2.377-33.111-17.795-63.619-14.667-24.588,2.521-24.952,15.781-48,17.524-31.257,2.364-37.144-21.526-66.286-18.286-22.112,2.459-27.281,17.164-54.857,19.175-13.013.949-23.861-1.451-30.857-3.556l-4.952-.19Z"/>

            <!-- Grey side panels -->
            <rect class="cls-1" x="292.762" y="149.714" width="60.064" height="335.619"/>
            <rect class="cls-1" x="8.571" y="149.714" width="60.064" height="335.619"/>

            <!-- Grey bottom -->
            <rect class="cls-1" x="8.571" y="458.286" width="344.381" height="27.048"/>

            <!-- Dark horizontal lines -->
            <rect class="cls-3" x="10.26" y="82.62" width="342.565" height="5.507"/>
            <rect class="cls-3" x="8.342" y="482.199" width="344.483" height="5.507"/>
        </svg>

        <div class="controls">
            <label>Tank Level:</label>
            <input type="range" id="levelSlider" min="0" max="100" value="100" step="1">
            <input type="number" id="levelInput" min="0" max="100" value="100" step="1">
            <span>%</span>
        </div>

        <div class="info">
            <h3>Usage Instructions</h3>
            <p><strong>Manual Control:</strong> Use the slider or input box above to change the tank level.</p>

            <p><strong>JavaScript API:</strong> Call <code>updateTankLevel(percentage)</code> from your code:</p>
            <pre style="background-color: #d1e7ed; padding: 10px; border-radius: 5px; overflow-x: auto;">
// Set tank to 75%
updateTankLevel(75);

// Animate from current to 50%
animateTankLevel(50, 1000); // 1000ms duration
            </pre>

            <p><strong>External Data Sources:</strong></p>
            <ul>
                <li>WebSocket: <code>ws.onmessage = (e) => updateTankLevel(e.data.level);</code></li>
                <li>REST API: <code>fetch('/api/tank').then(r => r.json()).then(d => updateTankLevel(d.level));</code></li>
                <li>MQTT: <code>client.on('message', (topic, msg) => updateTankLevel(JSON.parse(msg).level));</code></li>
            </ul>
        </div>
    </div>

    <script src="tank-controller.js"></script>
    <script>
        // Connect UI controls to the tank controller
        const slider = document.getElementById('levelSlider');
        const input = document.getElementById('levelInput');

        slider.addEventListener('input', (e) => {
            const value = parseInt(e.target.value);
            input.value = value;
            updateTankLevel(value);
        });

        input.addEventListener('input', (e) => {
            const value = parseInt(e.target.value);
            if (value >= 0 && value <= 100) {
                slider.value = value;
                updateTankLevel(value);
            }
        });

        // Initialize at 100%
        updateTankLevel(100);

        // Example: Simulate receiving data from external source
        // Uncomment to test random updates every 2 seconds
        /*
        setInterval(() => {
            const randomLevel = Math.floor(Math.random() * 101);
            animateTankLevel(randomLevel, 1000);
            slider.value = randomLevel;
            input.value = randomLevel;
        }, 2000);
        */
    </script>
</body>
</html>
